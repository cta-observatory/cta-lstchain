

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LST-1 data analysis workflow &mdash; lstchain 0.10.13.dev48+gcfd9a7f9 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=dc09e819"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js?v=4a39c7ea"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script src="_static/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How to Contribute" href="contribute.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            lstchain
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#data-levels">Data levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#analysis-steps">Analysis steps</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LST-1 data analysis workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pipeline">Pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lstmcpipe">lstmcpipe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lstosa">lstosa</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#files-and-configuration">Files and configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#selection-of-the-real-data-dl1-files">Selection of the real-data DL1 files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rf-models">RF models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tuning-of-mc-dl1-files-and-rf-models">Tuning of MC DL1 files and RF models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keeping-track-of-lstchain-configurations">Keeping track of lstchain configurations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dl3-irf-config-files">DL3/IRF config files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#environment">Environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">How to Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="snippets.html">Code snippets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lstchain_api/index.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">lstchain</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">LST-1 data analysis workflow</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lst_analysis_workflow.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lst-1-data-analysis-workflow">
<h1>LST-1 data analysis workflow<a class="headerlink" href="#lst-1-data-analysis-workflow" title="Link to this heading"></a></h1>
<section id="pipeline">
<h2>Pipeline<a class="headerlink" href="#pipeline" title="Link to this heading"></a></h2>
<p>Here is a simplified version of the LST-1 data analysis pipeline and the different tools used for each step:</p>
<a class="reference internal image-reference" href="https://mermaid.ink/img/pako:eNptkk2LwjAQhv9KyGkXLOh662EvusKCXuqxKTLbjlrIR0lSliL-9500DXTVHNJ8PO87M-nceG0a5Dk_S_NbX8F6ti-EFprRKJYnVb8d-5-Lhe76zrJMOq_qru0wyz6ZIqV0ZbGbVtVM9chu9x-nw6akDztsqhTATdZRUxbLeMmmcQGloBxnIXRnjTeaFiix9tboiUTdJL8YJcamYlodQn8XO5eAmOgDEFQNeBizswiShV31rHgsZ_ZOQREh44CI7X6VPFfJLuW4mtFPScxLeYmtJyxAoTQCxhfqhnAPGuTgWpdM1snkJcMXXKFV0DbUAbegEdxfUaHgOS0bPEMvveBC3wmF3pvjoGuee9vjgvcdeeO2BfqH6v_hV9N6Y3l-BunoEMftIXba2HD3P0O7zCs?type=png)](https://mermaid.live/edit#pako:eNptkk2LwjAQhv9KyGkXLOh662EvusKCXuqxKTLbjlrIR0lSliL-9500DXTVHNJ8PO87M-nceG0a5Dk_S_NbX8F6ti-EFprRKJYnVb8d-5-Lhe76zrJMOq_qru0wyz6ZIqV0ZbGbVtVM9chu9x-nw6akDztsqhTATdZRUxbLeMmmcQGloBxnIXRnjTeaFiix9tboiUTdJL8YJcamYlodQn8XO5eAmOgDEFQNeBizswiShV31rHgsZ_ZOQREh44CI7X6VPFfJLuW4mtFPScxLeYmtJyxAoTQCxhfqhnAPGuTgWpdM1snkJcMXXKFV0DbUAbegEdxfUaHgOS0bPEMvveBC3wmF3pvjoGuee9vjgvcdeeO2BfqH6v_hV9N6Y3l-BunoEMftIXba2HD3P0O7zCs"><img alt="LST-1 data analysis pipeline" class="align-center" src="https://mermaid.ink/img/pako:eNptkk2LwjAQhv9KyGkXLOh662EvusKCXuqxKTLbjlrIR0lSliL-9500DXTVHNJ8PO87M-nceG0a5Dk_S_NbX8F6ti-EFprRKJYnVb8d-5-Lhe76zrJMOq_qru0wyz6ZIqV0ZbGbVtVM9chu9x-nw6akDztsqhTATdZRUxbLeMmmcQGloBxnIXRnjTeaFiix9tboiUTdJL8YJcamYlodQn8XO5eAmOgDEFQNeBizswiShV31rHgsZ_ZOQREh44CI7X6VPFfJLuW4mtFPScxLeYmtJyxAoTQCxhfqhnAPGuTgWpdM1snkJcMXXKFV0DbUAbegEdxfUaHgOS0bPEMvveBC3wmF3pvjoGuee9vjgvcdeeO2BfqH6v_hV9N6Y3l-BunoEMftIXba2HD3P0O7zCs?type=png)](https://mermaid.live/edit#pako:eNptkk2LwjAQhv9KyGkXLOh662EvusKCXuqxKTLbjlrIR0lSliL-9500DXTVHNJ8PO87M-nceG0a5Dk_S_NbX8F6ti-EFprRKJYnVb8d-5-Lhe76zrJMOq_qru0wyz6ZIqV0ZbGbVtVM9chu9x-nw6akDztsqhTATdZRUxbLeMmmcQGloBxnIXRnjTeaFiix9tboiUTdJL8YJcamYlodQn8XO5eAmOgDEFQNeBizswiShV31rHgsZ_ZOQREh44CI7X6VPFfJLuW4mtFPScxLeYmtJyxAoTQCxhfqhnAPGuTgWpdM1snkJcMXXKFV0DbUAbegEdxfUaHgOS0bPEMvveBC3wmF3pvjoGuee9vjgvcdeeO2BfqH6v_hV9N6Y3l-BunoEMftIXba2HD3P0O7zCs" style="width: 1080px;" />
</a>
<p>The steps marked with lstchain must be run by the analysers using the corresponding lstchain command (see <a class="reference internal" href="introduction.html#introduction"><span class="std std-ref">the Analysis Steps</span></a>) .
Other tools are described below.</p>
<section id="lstmcpipe">
<h3>lstmcpipe<a class="headerlink" href="#lstmcpipe" title="Link to this heading"></a></h3>
<p>lstmcpipe handles the analysis of MC data on the cluster at La Palma.
It produces the trained models and the MC DL2 files required for data analysis.
Its usage is recommended in order to:
- avoid common mistakes and pitfalls
- do not worry about resources management for this part of the analysis which requires specific needs
- have a reproducible analysis
- have common analysis production and therefore save computing resources</p>
<p>If you need a specific MC analysis production, you can request one by opening a pull-request on the GitHub repository.</p>
<p>repository: <a class="reference external" href="https://github.com/cta-observatory/lstmcpipe">https://github.com/cta-observatory/lstmcpipe</a></p>
<p>documentation: <a class="reference external" href="https://cta-observatory.github.io/lstmcpipe">https://cta-observatory.github.io/lstmcpipe</a></p>
</section>
<section id="lstosa">
<h3>lstosa<a class="headerlink" href="#lstosa" title="Link to this heading"></a></h3>
<p>lstosa handles the analysis of real data on the cluster at La Palma.
It automatically produces the DL1 files required for data analysis.
Analysers should not need to use this package directly (it is maintained and handled by LSTOSA team), but use the DL1 files it produces.</p>
<p>repository: <a class="reference external" href="https://github.com/cta-observatory/lstosa">https://github.com/cta-observatory/lstosa</a></p>
<p>documentation: <a class="reference external" href="https://lstosa.readthedocs.io/">https://lstosa.readthedocs.io/</a></p>
</section>
</section>
<section id="files-and-configuration">
<h2>Files and configuration<a class="headerlink" href="#files-and-configuration" title="Link to this heading"></a></h2>
<p>The DL1 files to use obviously depend on the source you want to analyse.
Unless you have a good reason, the latest version of the DL1 files should be used.</p>
<section id="selection-of-the-real-data-dl1-files">
<h3>Selection of the real-data DL1 files<a class="headerlink" href="#selection-of-the-real-data-dl1-files" title="Link to this heading"></a></h3>
<p>The selection of the DL1 files (run-wise, i.e. those produced by lstosa by merging the subrun-wise DL1 files) for a
specific analysis (i.e., a given source and time period) can be performed using the notebook
<code class="docutils literal notranslate"><span class="pre">cta_lstchain/notebooks/data_quality.ipynb</span></code>. The selection also takes into account the quality of the data, mostly in
terms of atmospheric conditions - evaluated using the rate of cosmic-ray showers as a proxy. Data taken under poor
conditions will not be included in the list of selected runs. Instructions and further details can be found inside the
notebook.</p>
</section>
<section id="rf-models">
<h3>RF models<a class="headerlink" href="#rf-models" title="Link to this heading"></a></h3>
<p>The list of available trained RF models can be found in the lstmcpipe documentation and production list,
along with a description of each production:
<a class="reference external" href="https://cta-observatory.github.io/lstmcpipe/productions.html">https://cta-observatory.github.io/lstmcpipe/productions.html</a></p>
<p>The RF models are stored in the following directory:
<code class="docutils literal notranslate"><span class="pre">/fefs/aswg/data/models/...</span></code></p>
</section>
<section id="tuning-of-mc-dl1-files-and-rf-models">
<h3>Tuning of MC DL1 files and RF models<a class="headerlink" href="#tuning-of-mc-dl1-files-and-rf-models" title="Link to this heading"></a></h3>
<p>The default MC production is generated with a level of noise in the images which corresponds to the level of diffuse
night-sky background (“NSB”) in a “dark” field of view (i.e. for observations with moon below the horizon, at not-too-low
galactic latitudes and not affected by other sources of noise, like the zodiacal light). In general, observations of
<strong>extragalactic</strong> sources in dark conditions can be properly analyzed with the default MC (i.e. with the standard RF models).</p>
<p>The median of the standard deviation of the pixel charges recorded in interleaved pedestal events (in which  a camera
image is recorded in absence of a physics trigger) is a good measure of the NSB level in a given data run. This is computed
by the data selection notebook <code class="docutils literal notranslate"><span class="pre">cta_lstchain/notebooks/data_quality.ipynb</span></code> (see above). For data with an NSB level
significantly higher than the “dark field” one, it is possible to tune (increase) the noise in the MC files, and produce
from them RF models (and “test MC” for computing instrument response functions) which improve the performance of the
analysis (relative to using the default, low-NSB MC).</p>
<p>This is done by changing the configuration file for the MC processing, producing new DL1(b) files, and training new RF models.
To produce a config tuned to the data you want to analyse, you first have to obtain the standard analysis configuration
file (for MC) for the desired version of lstchain (= the version with which the real DL1 files you will use were produced).
This can be done with the script <a class="reference internal" href="lstchain_api/scripts/index.html#module-lstchain.scripts.lstchain_dump_config" title="lstchain.scripts.lstchain_dump_config"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lstchain_dump_config</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lstchain_dump_config</span> <span class="o">--</span><span class="n">mc</span> <span class="o">--</span><span class="n">output</span><span class="o">-</span><span class="n">file</span> <span class="n">standard_lstchain_config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>Now you have to update the file with the parameters needed to increase the NSB level. For this you need a simtel.gz MC
file from the desired production (any will do, it can be either a gamma or a proton file), and a “typical” subrun DL1 file
from your <strong>real data</strong>  sample. “Typical” means one in which the NSB level is close to the median value for the sample
to be analyzed. The data selection notebook <code class="docutils literal notranslate"><span class="pre">cta_lstchain/notebooks/data_quality.ipynb</span></code> (see above) provides a list of
a few such subruns for your selected sample - you can use any of them. To update the config file you have to use the
script <a class="reference internal" href="lstchain_api/scripts/index.html#module-lstchain.scripts.lstchain_tune_nsb" title="lstchain.scripts.lstchain_tune_nsb"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lstchain_tune_nsb</span></code></a> , e.g. :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lstchain_tune_nsb</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">config</span> <span class="n">standard_lstchain_config</span><span class="o">.</span><span class="n">json</span> \
                     <span class="o">--</span><span class="nb">input</span><span class="o">-</span><span class="n">mc</span> <span class="o">.../</span><span class="n">simtel_corsika_theta_6</span><span class="mf">.000</span><span class="n">_az_180</span><span class="mf">.000</span><span class="n">_run10</span><span class="o">.</span><span class="n">simtel</span><span class="o">.</span><span class="n">gz</span> \
                     <span class="o">--</span><span class="nb">input</span><span class="o">-</span><span class="n">data</span> <span class="o">.../</span><span class="n">dl1_LST</span><span class="o">-</span><span class="mf">1.</span><span class="n">Run10032</span><span class="mf">.0069</span><span class="o">.</span><span class="n">h5</span> \
                     <span class="o">-</span><span class="n">o</span> <span class="n">tuned_nsb_lstchain_config</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
<p>To request a <strong>new production of RF models</strong>, you can open a pull-request on the lstmcpipe repository, providing
the .json configuration file produced following the steps above.</p>
</section>
<section id="keeping-track-of-lstchain-configurations">
<h3>Keeping track of lstchain configurations<a class="headerlink" href="#keeping-track-of-lstchain-configurations" title="Link to this heading"></a></h3>
<p>The lstchain configuration file used to process the  simulations and produce the RF models of a given MC production is
provided in the lstmcpipe repository, as well as in the models directory.</p>
<p>It is important that the software version, and the configuration used for processing real data and MC are the same. For a
given lstchain version, this should be guaranteed by following the procedure above which makes use of
<a class="reference internal" href="lstchain_api/scripts/index.html#module-lstchain.scripts.lstchain_dump_config" title="lstchain.scripts.lstchain_dump_config"><code class="xref py py-obj docutils literal notranslate"><span class="pre">lstchain_dump_config</span></code></a>.</p>
</section>
<section id="dl3-irf-config-files">
<h3>DL3/IRF config files<a class="headerlink" href="#dl3-irf-config-files" title="Link to this heading"></a></h3>
<p>An example config file for IRF/DL3 creation is provided in <cite>docs/example</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="irf_dl3_tool_config.json">irf_dl3_tool_config.json</a></p></li>
</ul>
</div></blockquote>
<p>Such files should be used to produce DL3 files and IRFs from DL2 (see <a class="reference internal" href="introduction.html#introduction"><span class="std std-ref">the Analysis Steps</span></a>)</p>
</section>
</section>
<section id="environment">
<h2>Environment<a class="headerlink" href="#environment" title="Link to this heading"></a></h2>
<p>Conda environment are used to manage the dependencies of the analysis on the cluster at La Palma.
<strong>It is recommended to use the same environment for all the analysis steps.</strong></p>
<p>To use the main conda, add this to your <cite>.bashrc</cite>:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">conda setup</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;
# !! Contents within this block are managed by &#39;conda init&#39; !!
__conda_setup=&quot;$(&#39;/fefs/aswg/software/virtual_env/anaconda3/bin/conda&#39; &#39;shell.bash&#39; &#39;hook&#39; 2&gt; /dev/null)&quot;
if [ $? -eq 0 ]; then
    eval &quot;$__conda_setup&quot;
else
    if [ -f &quot;/fefs/aswg/software/virtual_env/anaconda3/etc/profile.d/conda.sh&quot; ]; then
        . &quot;/fefs/aswg/software/virtual_env/anaconda3/etc/profile.d/conda.sh&quot;
    else
        export PATH=&quot;/fefs/aswg/software/virtual_env/anaconda3/bin:$PATH&quot;
    fi
fi
unset __conda_setup
# &lt;&lt;&lt; conda initialize &lt;&lt;&lt;
</pre></div>
</div>
</div>
<p>Then, you can use the conda environment used to produce the MC files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="o">/</span><span class="n">fefs</span><span class="o">/</span><span class="n">aswg</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">ENV_NAME</span>
</pre></div>
</div>
<p>The <cite>ENV_NAME</cite> used for MC production is provided in the lstmcipe config file.</p>
<p>Note: you may also activate the environment defined here using your own conda installation.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contribute.html" class="btn btn-neutral float-right" title="How to Contribute" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright LST collaboration.  Last updated 24 Oct 2024 10:03.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>