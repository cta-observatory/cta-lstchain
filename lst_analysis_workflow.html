<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LST-1 data analysis workflow &mdash; lstchain 0.10.5.dev51+g675b2454 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="_static/custom.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="How to Contribute" href="contribute.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            lstchain
          </a>
              <div class="version">
                0.10.5.dev51+g675b2454
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#data-levels">Data levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html#analysis-steps">Analysis steps</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LST-1 data analysis workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pipeline">Pipeline</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#lstmcpipe">lstmcpipe</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lstosa">lstosa</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#files-and-configuration">Files and configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rf-models">RF models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tuning-of-dl1-files-and-rf-models">Tuning of DL1 files and RF models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lstchain-config">lstchain config</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dl3-irf-config-files">DL3/IRF config files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#environment">Environment</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">How to Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="snippets.html">Code snippets</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="lstchain_api/index.html">API Docs</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">lstchain</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">LST-1 data analysis workflow</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/lst_analysis_workflow.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="lst-1-data-analysis-workflow">
<h1>LST-1 data analysis workflow<a class="headerlink" href="#lst-1-data-analysis-workflow" title="Permalink to this headline">¶</a></h1>
<section id="pipeline">
<h2>Pipeline<a class="headerlink" href="#pipeline" title="Permalink to this headline">¶</a></h2>
<p>Here is a simplified version of the LST-1 data analysis pipeline and the different tools used for each step:</p>
<a class="reference internal image-reference" href="https://mermaid.ink/img/pako:eNptkk2LwjAQhv9KyGkXLOh662EvusKCXuqxKTLbjlrIR0lSliL-9500DXTVHNJ8PO87M-nceG0a5Dk_S_NbX8F6ti-EFprRKJYnVb8d-5-Lhe76zrJMOq_qru0wyz6ZIqV0ZbGbVtVM9chu9x-nw6akDztsqhTATdZRUxbLeMmmcQGloBxnIXRnjTeaFiix9tboiUTdJL8YJcamYlodQn8XO5eAmOgDEFQNeBizswiShV31rHgsZ_ZOQREh44CI7X6VPFfJLuW4mtFPScxLeYmtJyxAoTQCxhfqhnAPGuTgWpdM1snkJcMXXKFV0DbUAbegEdxfUaHgOS0bPEMvveBC3wmF3pvjoGuee9vjgvcdeeO2BfqH6v_hV9N6Y3l-BunoEMftIXba2HD3P0O7zCs?type=png)](https://mermaid.live/edit#pako:eNptkk2LwjAQhv9KyGkXLOh662EvusKCXuqxKTLbjlrIR0lSliL-9500DXTVHNJ8PO87M-nceG0a5Dk_S_NbX8F6ti-EFprRKJYnVb8d-5-Lhe76zrJMOq_qru0wyz6ZIqV0ZbGbVtVM9chu9x-nw6akDztsqhTATdZRUxbLeMmmcQGloBxnIXRnjTeaFiix9tboiUTdJL8YJcamYlodQn8XO5eAmOgDEFQNeBizswiShV31rHgsZ_ZOQREh44CI7X6VPFfJLuW4mtFPScxLeYmtJyxAoTQCxhfqhnAPGuTgWpdM1snkJcMXXKFV0DbUAbegEdxfUaHgOS0bPEMvveBC3wmF3pvjoGuee9vjgvcdeeO2BfqH6v_hV9N6Y3l-BunoEMftIXba2HD3P0O7zCs"><img alt="LST-1 data analysis pipeline" class="align-center" src="https://mermaid.ink/img/pako:eNptkk2LwjAQhv9KyGkXLOh662EvusKCXuqxKTLbjlrIR0lSliL-9500DXTVHNJ8PO87M-nceG0a5Dk_S_NbX8F6ti-EFprRKJYnVb8d-5-Lhe76zrJMOq_qru0wyz6ZIqV0ZbGbVtVM9chu9x-nw6akDztsqhTATdZRUxbLeMmmcQGloBxnIXRnjTeaFiix9tboiUTdJL8YJcamYlodQn8XO5eAmOgDEFQNeBizswiShV31rHgsZ_ZOQREh44CI7X6VPFfJLuW4mtFPScxLeYmtJyxAoTQCxhfqhnAPGuTgWpdM1snkJcMXXKFV0DbUAbegEdxfUaHgOS0bPEMvveBC3wmF3pvjoGuee9vjgvcdeeO2BfqH6v_hV9N6Y3l-BunoEMftIXba2HD3P0O7zCs?type=png)](https://mermaid.live/edit#pako:eNptkk2LwjAQhv9KyGkXLOh662EvusKCXuqxKTLbjlrIR0lSliL-9500DXTVHNJ8PO87M-nceG0a5Dk_S_NbX8F6ti-EFprRKJYnVb8d-5-Lhe76zrJMOq_qru0wyz6ZIqV0ZbGbVtVM9chu9x-nw6akDztsqhTATdZRUxbLeMmmcQGloBxnIXRnjTeaFiix9tboiUTdJL8YJcamYlodQn8XO5eAmOgDEFQNeBizswiShV31rHgsZ_ZOQREh44CI7X6VPFfJLuW4mtFPScxLeYmtJyxAoTQCxhfqhnAPGuTgWpdM1snkJcMXXKFV0DbUAbegEdxfUaHgOS0bPEMvveBC3wmF3pvjoGuee9vjgvcdeeO2BfqH6v_hV9N6Y3l-BunoEMftIXba2HD3P0O7zCs" style="width: 1080px;" /></a>
<p>The steps marked with lstchain must be run by the analysers using the corresponding lstchain command (see <a class="reference internal" href="introduction.html#introduction"><span class="std std-ref">the Analysis Steps</span></a>) .
Other tools are described below.</p>
<section id="lstmcpipe">
<h3>lstmcpipe<a class="headerlink" href="#lstmcpipe" title="Permalink to this headline">¶</a></h3>
<p>lstmcpipe handles the analysis of MC data on the cluster at La Palma.
It produces the trained models and the MC DL2 files required for data analysis.
Its usage is recommended in order to:
- avoid common mistakes and pitfalls
- do not worry about resources management for this part of the analysis which requires specific needs
- have a reproducible analysis
- have common analysis production and therefore save computing resources</p>
<p>If you need a specific MC analysis production, you can request one by opening a pull-request on the GitHub repository.</p>
<p>repository: <a class="reference external" href="https://github.com/cta-observatory/lstmcpipe">https://github.com/cta-observatory/lstmcpipe</a></p>
<p>documentation: <a class="reference external" href="https://cta-observatory.github.io/lstmcpipe">https://cta-observatory.github.io/lstmcpipe</a></p>
</section>
<section id="lstosa">
<h3>lstosa<a class="headerlink" href="#lstosa" title="Permalink to this headline">¶</a></h3>
<p>lstosa handles the analysis of real data on the cluster at La Palma.
It automatically produces the DL1 files required for data analysis.
Analysers should not need to use this package directly (it is maintained and handled by LSTOSA team), but use the DL1 files it produces.</p>
<p>repository: <a class="reference external" href="https://github.com/cta-observatory/lstosa">https://github.com/cta-observatory/lstosa</a></p>
<p>documentation: <a class="reference external" href="https://lstosa.readthedocs.io/">https://lstosa.readthedocs.io/</a></p>
</section>
</section>
<section id="files-and-configuration">
<h2>Files and configuration<a class="headerlink" href="#files-and-configuration" title="Permalink to this headline">¶</a></h2>
<p>The DL1 files to use obviously depend on the source you want to analyse.
Unless you have a good reason, the latest version of the DL1 files should be used.</p>
<section id="rf-models">
<h3>RF models<a class="headerlink" href="#rf-models" title="Permalink to this headline">¶</a></h3>
<p>The list of available trained RF models can be found in the lstmcpipe documentation and production list,
along with a description of each production:
<a class="reference external" href="https://cta-observatory.github.io/lstmcpipe/productions.html">https://cta-observatory.github.io/lstmcpipe/productions.html</a></p>
<p>The RF models are stored in the following directory:
<code class="docutils literal notranslate"><span class="pre">/fefs/aswg/data/models/...</span></code></p>
</section>
<section id="tuning-of-dl1-files-and-rf-models">
<h3>Tuning of DL1 files and RF models<a class="headerlink" href="#tuning-of-dl1-files-and-rf-models" title="Permalink to this headline">¶</a></h3>
<p>In case of high NSB in the data, it is possible to tune the DL1 files and the RF models to improve the performance of the analysis.
This is done by changing the <cite>config</cite> file of the RF models and producing new DL1 files and training new RF models.
To produce a config tuned to the data you want to analyse, you may run <code class="docutils literal notranslate"><span class="pre">lstchain_tune_nsb</span></code> function that will produce a <code class="docutils literal notranslate"><span class="pre">tuned_nsb_config.json</span></code> file.</p>
<p>To request a new production of RF models, you can open a pull-request on the lstmcpipe repository, producing a complete MC config, using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lstchain</span><span class="o">-</span><span class="n">dump</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="n">mc</span> <span class="o">--</span><span class="n">update</span><span class="o">-</span><span class="k">with</span> <span class="n">tuned_nsb_config</span><span class="o">.</span><span class="n">json</span> <span class="o">--</span><span class="n">output</span><span class="o">-</span><span class="n">file</span> <span class="n">PATH_TO_OUTPUT_FILE</span>
</pre></div>
</div>
</section>
<section id="lstchain-config">
<h3>lstchain config<a class="headerlink" href="#lstchain-config" title="Permalink to this headline">¶</a></h3>
<p>The lstchain config used to produce the RF models of a production is provided in the lstmcpipe repository, as well as in the models directory.
It is a good idea to use the same config for the data analysis.
You can also produce a config using <cite>lstchain-dump-config</cite>.</p>
</section>
<section id="dl3-irf-config-files">
<h3>DL3/IRF config files<a class="headerlink" href="#dl3-irf-config-files" title="Permalink to this headline">¶</a></h3>
<p>DL3/IRF example config files are provided in <cite>docs/example</cite>:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="dl3_tool_config.json">dl3_tool_config.json</a></p></li>
<li><p><a class="reference external" href="irf_tool_config.json">irf_tool_config.json</a></p></li>
</ul>
</div></blockquote>
<p>Such files should be used to produce DL3 files and IRFs from DL2 (see <a class="reference internal" href="introduction.html#introduction"><span class="std std-ref">the Analysis Steps</span></a>)</p>
</section>
</section>
<section id="environment">
<h2>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h2>
<p>Conda environment are used to manage the dependencies of the analysis on the cluster at La Palma.
<strong>It is recommended to use the same environment for all the analysis steps.</strong></p>
<p>To use the main conda, add this to your <cite>.bashrc</cite>:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">conda setup</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># &gt;&gt;&gt; conda initialize &gt;&gt;&gt;
# !! Contents within this block are managed by &#39;conda init&#39; !!
__conda_setup=&quot;$(&#39;/fefs/aswg/software/virtual_env/anaconda3/bin/conda&#39; &#39;shell.bash&#39; &#39;hook&#39; 2&gt; /dev/null)&quot;
if [ $? -eq 0 ]; then
    eval &quot;$__conda_setup&quot;
else
    if [ -f &quot;/fefs/aswg/software/virtual_env/anaconda3/etc/profile.d/conda.sh&quot; ]; then
        . &quot;/fefs/aswg/software/virtual_env/anaconda3/etc/profile.d/conda.sh&quot;
    else
        export PATH=&quot;/fefs/aswg/software/virtual_env/anaconda3/bin:$PATH&quot;
    fi
fi
unset __conda_setup
# &lt;&lt;&lt; conda initialize &lt;&lt;&lt;
</pre></div>
</div>
</div>
<p>Then, you can use the conda environment used to produce the MC files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="o">/</span><span class="n">fefs</span><span class="o">/</span><span class="n">aswg</span><span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">conda</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">ENV_NAME</span>
</pre></div>
</div>
<p>The <cite>ENV_NAME</cite> used for MC production is provided in the lstmcipe config file.</p>
<p>Note: you may also activate the environment defined here using your own conda installation.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="contribute.html" class="btn btn-neutral float-right" title="How to Contribute" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright LST collaboration.  Last updated 05 Oct 2023 14:15.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>